version: '3.8'
services:
  portainer:
    image: portainer/portainer-ce
    container_name: Portainer
    networks:
      - home_network
    ports:
      - "9000:9000"  # Port mapping for Portainer
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /mnt/lab-docker-config/portainer:/data
    restart: unless-stopped

  heimdall:
    image: linuxserver/heimdall
    container_name: Heimdall
    networks:
      - home_network
    ports:
      - "8008:80"  # Port mapping for Heimdall
    volumes:
      - /mnt/lab-docker-config-local/heimdall:/config
    restart: unless-stopped

  syncthing:
    image: linuxserver/syncthing
    container_name: syncthing
    networks:
      - home_network
    ports:
      - "8384:8384"  # Port mapping for Syncthing GUI
      - "22000:22000"  # Port mapping for Syncthing listening port
      - "21027:21027/udp"  # Port mapping for Syncthing discovery port
    volumes:
      - /mnt/lab-docker-config-local/syncthing:/config
      - /mnt/syncthing/data:/data
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Melbourne
    restart: unless-stopped

  jellyfin:
    image: jellyfin/jellyfin
    container_name: jellyfin
    networks:
      - home_network
    ports:
      - "8096:8096"  # Port mapping for Jellyfin
    volumes:
      - /mnt/lab-docker-config-local/jellyfin:/config
      - /mnt/media:/media
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Melbourne
    restart: unless-stopped

  emby:
    image: linuxserver/emby
    container_name: emby
    networks:
      - home_network
    ports:
      - "8097:8096"  # Port mapping for Emby
    volumes:
      - /mnt/lab-docker-config-local/emby:/config
      - /mnt/media:/media
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Melbourne
    restart: unless-stopped 

  foldingathome:
    image: linuxserver/foldingathome
    container_name: foldingathome
    networks:
      - home_network
    ports:
      - "7396:7396"  # Port mapping for Folding@home Web Control
    volumes:
      - /mnt/lab-docker-config-local/foldingathome:/config
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Melbourne
      - ACCOUNT_TOKEN=bfL8RbfMvec0Jveca6sQda6s4KG2W4KGICde7ICd_t8
      - MACHINE_NAME=Mariette
      - GPU=true  # Enable GPU folding
      - NVIDIA_VISIBLE_DEVICES=all  # Make all GPUs visible
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility  # Required capabilities
    devices:
      - /dev/nvidia0:/dev/nvidia0
      - /dev/nvidia-caps:/dev/nvidia-caps
      - /dev/nvidiactl:/dev/nvidiactl
      - /dev/nvidia-modeset:/dev/nvidia-modeset
      - /dev/nvidia-uvm:/dev/nvidia-uvm
      - /dev/nvidia-uvm-tools:/dev/nvidia-uvm-tools
    runtime: nvidia
    restart: unless-stopped

  ollama:
    image: ollama/ollama
    container_name: ollama
    networks:
      - home_network
    ports:
      - "11434:11434"
    volumes:
      - /mnt/lab-docker-config-local/ollama:/config
      - /mnt/lab-docker-config-local/ollama-models:/root/.ollama
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Melbourne
    devices:
      - /dev/nvidia0:/dev/nvidia0
      - /dev/nvidia-caps:/dev/nvidia-caps
      - /dev/nvidiactl:/dev/nvidiactl
      - /dev/nvidia-modeset:/dev/nvidia-modeset
      - /dev/nvidia-uvm:/dev/nvidia-uvm
      - /dev/nvidia-uvm-tools:/dev/nvidia-uvm-tools
    runtime: nvidia
    restart: unless-stopped

  open-webui:
    image: ollama/open-webui
    container_name: open-webui
    networks:
      - home_network
    ports:
      - "8080:8080"  # Adjust the port as needed
    volumes:
      - /mnt/lab-docker-config-local/open-webui:/config
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Australia/Melbourne
    restart: unless-stopped

networks:
  home_network:
    external: true